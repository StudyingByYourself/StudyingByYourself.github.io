<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.1.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/zhoukaiqi/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/zhoukaiqi/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/zhoukaiqi/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/zhoukaiqi/images/logo.svg" color="#222">

<link rel="stylesheet" href="/zhoukaiqi/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=consolas:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/zhoukaiqi/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"zhoukaiqi.gitee.io","root":"/zhoukaiqi/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="本文介绍了gdb的常见用法。">
<meta property="og:type" content="article">
<meta property="og:title" content="gdb使用">
<meta property="og:url" content="https://zhoukaiqi.gitee.io/ffde21da3a9c/index.html">
<meta property="og:site_name" content="数风流人物，还看今朝">
<meta property="og:description" content="本文介绍了gdb的常见用法。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-04-05T07:00:31.000Z">
<meta property="article:modified_time" content="2022-09-23T14:28:23.929Z">
<meta property="article:author" content="CodeKai">
<meta property="article:tag" content="gdb">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://zhoukaiqi.gitee.io/ffde21da3a9c/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>gdb使用 | 数风流人物，还看今朝</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/zhoukaiqi/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">数风流人物，还看今朝</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/zhoukaiqi/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/zhoukaiqi/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/zhoukaiqi/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/zhoukaiqi/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/zhoukaiqi/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://zhoukaiqi.gitee.io/ffde21da3a9c/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/zhoukaiqi/images/header.png">
      <meta itemprop="name" content="CodeKai">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="数风流人物，还看今朝">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          gdb使用
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-05 15:00:31" itemprop="dateCreated datePublished" datetime="2021-04-05T15:00:31+08:00">2021-04-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-09-23 22:28:23" itemprop="dateModified" datetime="2022-09-23T22:28:23+08:00">2022-09-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/zhoukaiqi/categories/gdb/" itemprop="url" rel="index"><span itemprop="name">gdb</span></a>
                </span>
            </span>

          
            <span id="/zhoukaiqi/ffde21da3a9c/" class="post-meta-item leancloud_visitors" data-flag-title="gdb使用" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/zhoukaiqi/ffde21da3a9c/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/zhoukaiqi/ffde21da3a9c/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>6.1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>6 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>本文介绍了gdb的常见用法。</p>
<span id="more"></span>
<h6 id="1、入参与返回值">1、入参与返回值</h6>
<table>
<thead>
<tr>
<th style="text-align:left">CPU</th>
<th style="text-align:left">入参</th>
<th style="text-align:left">返回值</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">x86</td>
<td style="text-align:left">ebp+8, ebp+12, ebp+16, ebp+20</td>
<td style="text-align:left">eax</td>
</tr>
<tr>
<td style="text-align:left">x86_64</td>
<td style="text-align:left">rdi, rsi, rdx, rcx, r8, r9</td>
<td style="text-align:left">rax</td>
</tr>
<tr>
<td style="text-align:left">arm64</td>
<td style="text-align:left">x0, x1, x2, x3, x4, x5, x6, x7</td>
<td style="text-align:left">x0</td>
</tr>
</tbody>
</table>
<p>返回值需要在执行finish后查看</p>
<h6 id="2、常见命令">2、常见命令</h6>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">gdb -q bin                                   // 启动时不显示提示信息</span><br><span class="line">handle SIG35 SIG36 SIGUSR2 nostop noprint    // 屏蔽某些信号</span><br><span class="line"><span class="built_in">set</span> height 0                                 // 不限制输出行数</span><br><span class="line"><span class="built_in">set</span> <span class="built_in">print</span> pretty on                          // 美化结构体打印</span><br><span class="line">i thread                                     // 查看所有线程信息</span><br><span class="line">thread threadno                              // 切换到指定线程</span><br><span class="line">thread apply all bt                          // 查看所有线程栈信息</span><br><span class="line"><span class="built_in">printf</span> <span class="string">&quot;Handle[%u], PtNo[%u]\n&quot;</span>, <span class="variable">$rdi</span>, <span class="variable">$rsi</span>  // 打印信息</span><br><span class="line"><span class="built_in">set</span> <span class="built_in">print</span> thread-events off                  // 不显示线程启动和退出信息</span><br><span class="line">call getpid()                                // 获取拉起进程的pid</span><br><span class="line">shell <span class="built_in">date</span> +%H:%M:%S.%N                      // 加shell可以执行linux命令</span><br><span class="line">i r                                          // 查看寄存器信息</span><br><span class="line">generate-core-file                           // 生成core文件</span><br><span class="line">bt n(-n)                                     // 显示栈顶(栈底)的n层栈</span><br><span class="line">x addr                                       // 解析addr对应的函数</span><br><span class="line">x/s str                                      // 显示str对应的字符串</span><br><span class="line">x/nbx                                        // 显示n个单字节</span><br><span class="line">x/nhx                                        // 显示n个双字节</span><br><span class="line">x/nwx                                        // 显示n个4字节</span><br><span class="line">x/ngx                                        // 显示n个8字节</span><br><span class="line">frame n                                      // 切换到第n层栈帧（切换栈帧后i r查看的寄存器可能并不可信）</span><br><span class="line">disassemble func                             // 反汇编函数</span><br><span class="line">disassemble func, +n                         // 反汇编函数的指定n字节</span><br><span class="line">disassemble /m func                          // 显示源码和汇编(编译选项要加-g)</span><br><span class="line">disassemble /r func                          // 显示汇编和机器码</span><br><span class="line">disassemble /mr func                         // 显示源码、汇编和机器码</span><br><span class="line">watch  *addr                                 // 监控地址被写</span><br><span class="line">rwatch *addr                                 // 监控地址被读</span><br><span class="line">awatch *addr                                 // 监控地址被读写</span><br><span class="line">ptype /o struct xxx_type                     // 查看结构体成员的偏移量</span><br><span class="line">n                                            // 执行1行</span><br><span class="line">ni                                           // 执行1条指令</span><br></pre></td></tr></table></figure>
<h6 id="3、条件断点">3、条件断点</h6>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x86 32位:  b func <span class="keyword">if</span> *(unsigned int*)(<span class="variable">$ebp</span>+8) == 226 &amp;&amp; *(unsigned int*)(<span class="variable">$ebp</span>+16) == 206</span><br><span class="line">x86 64位:  b func <span class="keyword">if</span> <span class="variable">$rdi</span> == 226 &amp;&amp; <span class="variable">$rdx</span> == 206</span><br><span class="line">arm 64位:  b func <span class="keyword">if</span> <span class="variable">$x0</span> == 226 &amp;&amp; <span class="variable">$x2</span> == 206</span><br><span class="line">线程断点:  b func thread threadno <span class="keyword">if</span> condition</span><br><span class="line">字符断点:  b func <span class="keyword">if</span> *(unsigned char*)(<span class="variable">$ebp</span>+8)==<span class="string">&#x27;A&#x27;</span></span><br></pre></td></tr></table></figure>
<h6 id="4、查看所有线程栈信息">4、查看所有线程栈信息</h6>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gdb attach pid</span><br><span class="line"><span class="built_in">set</span> height <span class="number">0</span></span><br><span class="line">handle SIG35 SIG36 SIGUSR2 nostop noprint</span><br><span class="line">i thread</span><br><span class="line">thread apply all bt</span><br><span class="line">det</span><br><span class="line">q</span><br></pre></td></tr></table></figure>
<h6 id="5、查看调用栈">5、查看调用栈</h6>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">gdb attach pid</span><br><span class="line"><span class="built_in">set</span> height 0</span><br><span class="line">handle SIG35 SIG36 SIGUSR2 nostop noprint</span><br><span class="line">b func</span><br><span class="line"><span class="built_in">command</span></span><br><span class="line">bt</span><br><span class="line">det</span><br><span class="line">q</span><br><span class="line">end</span><br><span class="line">c</span><br></pre></td></tr></table></figure>
<h6 id="6、抓取异常时刻的调用栈和寄存器">6、抓取异常时刻的调用栈和寄存器</h6>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">gdb attach pid</span><br><span class="line"><span class="built_in">set</span> height 0</span><br><span class="line">handle SIG35 SIG36 SIGUSR2 nostop noprint</span><br><span class="line">c</span><br><span class="line">bt</span><br><span class="line">i r</span><br></pre></td></tr></table></figure>
<h6 id="7、查看入参和返回值">7、查看入参和返回值</h6>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">gdb attach pid   ----------//进程的pid由ps -ef | grep xxx查询到</span><br><span class="line"><span class="built_in">set</span> height 0</span><br><span class="line">handle SIG35 SIG36 SIGUSR2 nostop noprint</span><br><span class="line">define oops</span><br><span class="line">bt        ----------// 显示调用栈</span><br><span class="line">i r       ----------// 显示寄存器信息，主要看入参，x86 32位进程看入参要替换成x/8wx <span class="variable">$ebp</span>+8</span><br><span class="line">fin       ----------// 表示执行完当前打断点的函数func</span><br><span class="line">i r       ----------// 在fin之后表示显示返回值，x86，x86_64，arm的返回值依次对应eax,rax,x0</span><br><span class="line">det</span><br><span class="line">q</span><br><span class="line">end</span><br><span class="line">b func    ----------// func即打断点的函数</span><br><span class="line"><span class="built_in">command</span></span><br><span class="line">oops</span><br><span class="line">end</span><br><span class="line">c</span><br></pre></td></tr></table></figure>
<h6 id="8、查看出参">8、查看出参</h6>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">gdb attach `pidof demo`</span><br><span class="line"><span class="built_in">set</span> height 0</span><br><span class="line">handle SIG35 SIG36 SIGUSR2 nostop noprint</span><br><span class="line">define ops</span><br><span class="line">bt</span><br><span class="line">i r</span><br><span class="line">x/s <span class="variable">$rdi</span></span><br><span class="line">p <span class="variable">$rsi</span></span><br><span class="line"><span class="built_in">set</span> <span class="variable">$a</span>=<span class="variable">$rdx</span></span><br><span class="line">fin</span><br><span class="line">x/5wx <span class="variable">$a</span></span><br><span class="line">x/s <span class="variable">$a</span></span><br><span class="line">p *(unsigned int*)(<span class="variable">$a</span>+16)</span><br><span class="line">det</span><br><span class="line">q</span><br><span class="line">end</span><br><span class="line">b func</span><br><span class="line"><span class="built_in">command</span></span><br><span class="line">ops</span><br><span class="line">end</span><br><span class="line">c</span><br></pre></td></tr></table></figure>
<h6 id="9、在函数func2执行之后再执行函数func1">9、在函数<code>func2</code>执行之后再执行函数<code>func1</code></h6>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">gdb attach `pidof demo`</span><br><span class="line"><span class="built_in">set</span> height 0</span><br><span class="line">handle SIG35 SIG36 SIGUSR2 nostop noprint</span><br><span class="line">b func1</span><br><span class="line"><span class="built_in">command</span></span><br><span class="line">bt</span><br><span class="line">det</span><br><span class="line">q</span><br><span class="line">end</span><br><span class="line"><span class="built_in">disable</span> 1</span><br><span class="line">b func2</span><br><span class="line"><span class="built_in">command</span></span><br><span class="line"><span class="built_in">enable</span> 1</span><br><span class="line">bt</span><br><span class="line">c</span><br><span class="line">end</span><br><span class="line">c</span><br></pre></td></tr></table></figure>
<h6 id="10、重定向到linux屏幕">10、重定向到linux屏幕</h6>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重定向后，调用printf的打印会输出到指定的屏幕</span></span><br><span class="line">gdb attach 10889</span><br><span class="line"><span class="built_in">set</span> height 0</span><br><span class="line">handle SIG35 SIG36 SIGUSR2 nostop noprint</span><br><span class="line">call (int)close(1)</span><br><span class="line">call (int)close(2)</span><br><span class="line"><span class="comment"># 此处的路径用tty查询</span></span><br><span class="line">call (int)(<span class="string">&quot;/dev/tty1&quot;</span>, 2)</span><br><span class="line">detach</span><br><span class="line">q</span><br></pre></td></tr></table></figure>
<h6 id="11、扫描core文件1">11、扫描core文件1</h6>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">define mem_scan</span><br><span class="line">    <span class="built_in">set</span> logging file xxx.txt</span><br><span class="line">    <span class="built_in">set</span> logging on</span><br><span class="line">    <span class="built_in">set</span> logging overwrite on</span><br><span class="line">    <span class="built_in">set</span> height 0</span><br><span class="line">    <span class="built_in">set</span> <span class="built_in">print</span> pretty on</span><br><span class="line">    <span class="built_in">set</span> <span class="variable">$g_index</span> = 0</span><br><span class="line">    <span class="keyword">while</span> (xxx)</span><br><span class="line">        <span class="built_in">printf</span> <span class="string">&quot;**************************\n&quot;</span></span><br><span class="line">        // 具体扫描实现</span><br><span class="line">        <span class="built_in">printf</span> <span class="string">&quot;**************************\n&quot;</span></span><br><span class="line">        <span class="built_in">set</span> = <span class="variable">$g_index</span> + 1</span><br><span class="line">    end</span><br><span class="line">    <span class="built_in">set</span> logging off</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">mem_scan</span><br></pre></td></tr></table></figure>
<h6 id="12、扫描core文件2">12、扫描core文件2</h6>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">gdb attach pid</span><br><span class="line"><span class="built_in">set</span> height 0</span><br><span class="line">handle SIG35 SIG36 SIGUSR2 nostop noprint</span><br><span class="line"><span class="comment"># 数组</span></span><br><span class="line"><span class="built_in">set</span> <span class="variable">$array</span> = &#123;1, 3, 5, 7, 9&#125;</span><br><span class="line"><span class="built_in">set</span> <span class="variable">$num</span> = sizeof(<span class="variable">$array</span>) / 4</span><br><span class="line"><span class="built_in">set</span> <span class="variable">$index</span> = 0</span><br><span class="line"><span class="keyword">while</span> (<span class="variable">$index</span> &lt; <span class="variable">$num</span>)</span><br><span class="line">    <span class="built_in">set</span> <span class="variable">$linkNo</span> = <span class="variable">$array</span>[<span class="variable">$index</span>]</span><br><span class="line">    <span class="built_in">set</span> <span class="variable">$tmp</span> = *(unsigned long*)&amp;g_state + <span class="variable">$linkNo</span> * 8</span><br><span class="line">    <span class="built_in">set</span> <span class="variable">$plane</span> = *(unsigned long*)<span class="variable">$tmp</span></span><br><span class="line">    <span class="built_in">printf</span> <span class="string">&quot;Plane[%u]\n&quot;</span>, <span class="variable">$plane</span></span><br><span class="line">    <span class="built_in">set</span> <span class="variable">$index</span> = <span class="variable">$index</span> + 1</span><br><span class="line">end</span><br><span class="line">det</span><br><span class="line">q</span><br></pre></td></tr></table></figure>
<h6 id="13、内存搜索">13、内存搜索</h6>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">搜索某块内存中的value</span><br><span class="line">find [/sn] start_addr, +len, val1 [, val2, ...]</span><br><span class="line">find [/sn] start_addr, end_addr, val1 [, val2, ...]</span><br><span class="line">s：表示搜索value所占的字节数，b/h/w/g</span><br><span class="line">n：表示最多输出n个查找结果</span><br><span class="line"></span><br><span class="line">具体示例</span><br><span class="line"><span class="number">0x7f55fa12ce70</span>: <span class="number">0x12345678</span> <span class="number">0x00000000</span> <span class="number">0x00000000</span> <span class="number">0x12340000</span></span><br><span class="line"><span class="number">0x7f55fa12ce80</span>: <span class="number">0xdeaddead</span> <span class="number">0x00000000</span> <span class="number">0xdeaddead</span> <span class="number">0x00000000</span></span><br><span class="line">(gdb) find /w2 <span class="number">0x7f55fa12ce70</span>, +<span class="number">0x20</span>, <span class="number">0xdeaddead</span></span><br><span class="line"><span class="number">0x7f55fa12ce80</span></span><br><span class="line"><span class="number">0x7f55fa12ce88</span></span><br><span class="line"><span class="number">2</span> patterns found.</span><br><span class="line">(gdb) find /w2 <span class="number">0x7f55fa12ce70</span>, <span class="number">0x7f55fa12ce90</span>, <span class="number">0xdeaddead</span></span><br><span class="line"><span class="number">0x7f55fa12ce80</span></span><br><span class="line"><span class="number">0x7f55fa12ce88</span></span><br><span class="line"><span class="number">2</span> patterns found.</span><br></pre></td></tr></table></figure>
<h6 id="14、gdb-shell脚本">14、gdb shell脚本</h6>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">RunGDB</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">local</span> cmdFile=gdb.txt</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span> &gt; <span class="string">&quot;<span class="variable">$cmdFile</span>&quot;</span></span><br><span class="line">    gdb -q -batch -x <span class="string">&quot;<span class="variable">$cmdFile</span>&quot;</span>  2&gt;/dev/null</span><br><span class="line">    <span class="built_in">rm</span> <span class="string">&quot;<span class="variable">$cmdFile</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">AttachByPid</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">local</span> pid=<span class="variable">$1</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">local</span> gdbCmdPre=<span class="string">&quot;</span></span><br><span class="line"><span class="string">attach <span class="variable">$pid</span></span></span><br><span class="line"><span class="string">set height 0</span></span><br><span class="line"><span class="string">set print thread-events off</span></span><br><span class="line"><span class="string">set print inferior-events off</span></span><br><span class="line"><span class="string">handle SIG35 SIG36 SIGUSR2 nostop noprint&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">local</span> gdbCmd=<span class="string">&quot;<span class="variable">$gdbCmdPre</span></span></span><br><span class="line"><span class="string">b FuncD&quot;</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string">command</span></span><br><span class="line"><span class="string">    bt</span></span><br><span class="line"><span class="string">    i r $rsp $rbp</span></span><br><span class="line"><span class="string">    set $tmprbp = $rbp</span></span><br><span class="line"><span class="string">    set $index = 0</span></span><br><span class="line"><span class="string">    while $index &lt; 4</span></span><br><span class="line"><span class="string">        set $nextrbp = *(unsigned long*)$tmprbp</span></span><br><span class="line"><span class="string">        set $func = *(unsigned long*)($tmprbp + 8)</span></span><br><span class="line"><span class="string">        printf &quot;rbp[0x%lx], func[0x%lx]\n&quot;, $tmprbp, $func</span></span><br><span class="line"><span class="string">        set $tmprbp = $nextrbp</span></span><br><span class="line"><span class="string">        set $index = $index + 1</span></span><br><span class="line"><span class="string">    end</span></span><br><span class="line"><span class="string">    det</span></span><br><span class="line"><span class="string">    q</span></span><br><span class="line"><span class="string">end</span></span><br><span class="line"><span class="string">c&#x27;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">        RunGDB <span class="string">&quot;<span class="variable">$gdbCmd</span>&quot;</span></span><br><span class="line">        <span class="built_in">sleep</span> 2</span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">AttachByPid <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br></pre></td></tr></table></figure>
<p>实际使用需要修改commmad和end之间的内容。</p>
<h6 id="15、errno">15、errno</h6>
<blockquote>
<p>gdb 在p errno 时报错</p>
<p>Cannot find thread-local storage for LWP 1181993, shared library /usr/lib64/libc.so.6</p>
<p>Cannot find thread-local variables on this target</p>
</blockquote>
<p>修改成<code>p *(unsigned int*)((void *)__errno_location())</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x0000000000401210</span> &lt;+<span class="number">118</span>&gt;:   callq  <span class="number">0x401030</span> &lt;__errno_location@plt&gt;</span><br></pre></td></tr></table></figure>
<h6 id="16、tips">16、tips</h6>
<p>frame切换栈帧后，易失性寄存器的值不准确。</p>
<blockquote>
<p>总而言之，一些挥发性寄存器的值可能随着栈帧的展开而不断的累加错误。也就是这里所说的：如果栈帧越靠外层，这些挥发性寄存器的值就越容易不准确。<br>
Usually ABIs reserve some registers as not needed to be saved by the callee (a.k.a.: “caller-saved”, “call-clobbered” or “volatile” registers). It may therefore not be possible for GDB to know the value a register had before the call (in other words, in the outer frame), if the register value has since been changed by the callee. GDB tries to deduce where the inner frame saved (“callee-saved”) registers, from the debug info, unwind info, or the machine code generated by your compiler. If some register is not saved, and GDB knows the register is “caller-saved” (via its own knowledge of the ABI, or because the debug/unwind info explicitly says the register’s value is undefined), GDB displays ‘<not saved>’ as the register’s value. With targets that GDB has no knowledge of the register saving convention, if a register was not saved by the callee, then its value and location in the outer frame are assumed to be the same of the inner frame. This is usually harmless, because if the register is call-clobbered, the caller either does not care what is in the register after the call, or has code to restore the value that it does care about. Note, however, that if you change such a register in the outer frame, you may also be affecting the inner frame. <strong>Also, the more “outer” the frame is you’re looking at, the more likely a call-clobbered register’s value is to be wrong, in the sense that it doesn’t actually represent the value the register had just before the call</strong>.</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/tsecer/p/11371549.html">https://www.cnblogs.com/tsecer/p/11371549.html</a></p>
<p>参考：<a target="_blank" rel="noopener" href="https://wizardforcel.gitbooks.io/100-gdb-tips/content/info-function.html">https://wizardforcel.gitbooks.io/100-gdb-tips/content/info-function.html</a></p>

    </div>

    
    
    
        <div class="reward-container">
  <div></div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/zhoukaiqi/images/wechatpay.png" alt="CodeKai 微信支付">
        <p>微信支付</p>
      </div>

  </div>
</div>


      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/zhoukaiqi/tags/gdb/" rel="tag"><i class="fa fa-tag"></i> gdb</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item"></div>
      <div class="post-nav-item">
    <a href="/zhoukaiqi/1d4d4cadb785/" rel="next" title="x86_84常见汇编指令">
      x86_84常见汇编指令 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-6"><a class="nav-link" href="#1%E3%80%81%E5%85%A5%E5%8F%82%E4%B8%8E%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="nav-text">1、入参与返回值</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#2%E3%80%81%E5%B8%B8%E8%A7%81%E5%91%BD%E4%BB%A4"><span class="nav-text">2、常见命令</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#3%E3%80%81%E6%9D%A1%E4%BB%B6%E6%96%AD%E7%82%B9"><span class="nav-text">3、条件断点</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#4%E3%80%81%E6%9F%A5%E7%9C%8B%E6%89%80%E6%9C%89%E7%BA%BF%E7%A8%8B%E6%A0%88%E4%BF%A1%E6%81%AF"><span class="nav-text">4、查看所有线程栈信息</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#5%E3%80%81%E6%9F%A5%E7%9C%8B%E8%B0%83%E7%94%A8%E6%A0%88"><span class="nav-text">5、查看调用栈</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#6%E3%80%81%E6%8A%93%E5%8F%96%E5%BC%82%E5%B8%B8%E6%97%B6%E5%88%BB%E7%9A%84%E8%B0%83%E7%94%A8%E6%A0%88%E5%92%8C%E5%AF%84%E5%AD%98%E5%99%A8"><span class="nav-text">6、抓取异常时刻的调用栈和寄存器</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#7%E3%80%81%E6%9F%A5%E7%9C%8B%E5%85%A5%E5%8F%82%E5%92%8C%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="nav-text">7、查看入参和返回值</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#8%E3%80%81%E6%9F%A5%E7%9C%8B%E5%87%BA%E5%8F%82"><span class="nav-text">8、查看出参</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#9%E3%80%81%E5%9C%A8%E5%87%BD%E6%95%B0func2%E6%89%A7%E8%A1%8C%E4%B9%8B%E5%90%8E%E5%86%8D%E6%89%A7%E8%A1%8C%E5%87%BD%E6%95%B0func1"><span class="nav-text">9、在函数func2执行之后再执行函数func1</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#10%E3%80%81%E9%87%8D%E5%AE%9A%E5%90%91%E5%88%B0linux%E5%B1%8F%E5%B9%95"><span class="nav-text">10、重定向到linux屏幕</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#11%E3%80%81%E6%89%AB%E6%8F%8Fcore%E6%96%87%E4%BB%B61"><span class="nav-text">11、扫描core文件1</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#12%E3%80%81%E6%89%AB%E6%8F%8Fcore%E6%96%87%E4%BB%B62"><span class="nav-text">12、扫描core文件2</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#13%E3%80%81%E5%86%85%E5%AD%98%E6%90%9C%E7%B4%A2"><span class="nav-text">13、内存搜索</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#14%E3%80%81gdb-shell%E8%84%9A%E6%9C%AC"><span class="nav-text">14、gdb shell脚本</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#15%E3%80%81errno"><span class="nav-text">15、errno</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#16%E3%80%81tips"><span class="nav-text">16、tips</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="CodeKai"
      src="/zhoukaiqi/images/header.png">
  <p class="site-author-name" itemprop="name">CodeKai</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/zhoukaiqi/archives/">
        
          <span class="site-state-item-count">20</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/zhoukaiqi/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/zhoukaiqi/tags/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">CodeKai</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">89k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">1:21</span>
</div><div>
    <!--添加总阅读次数-->
    <div>
        <span>本站总访问量</span>
        <span id="site_total_read_count">Loading...</span>
    </div>
    <script>
        async function sleep(ms = 1000) {
            return await new Promise(resolve => {
                const timer = setTimeout(() => {
                    clearTimeout(timer)
                    return resolve()
                }, ms)
            })
        }
        async function site_read_count() {
            const className = 'Counter',
                query = new AV.Query(className)
            return query.find()
                .then(_ => _.map(i => i.attributes.time))
                .then(_ => _.reduce((a, b) => a + b))
        }
        new Promise(resolve => {
            const timer = setInterval(() => {
                if (typeof AV !== "undefined") {
                    clearInterval(timer)
                    return resolve()
                }
            }, 250)
        })
            .then(() => site_read_count())
            .then(_ => {
                const s = ` ${_} 次`
                document.getElementById("site_total_read_count").innerHTML = s
            })
            .catch(e => console.error(e.message))
    </script>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/zhoukaiqi/lib/anime.min.js"></script>
  <script src="/zhoukaiqi/lib/velocity/velocity.min.js"></script>
  <script src="/zhoukaiqi/lib/velocity/velocity.ui.min.js"></script>

<script src="/zhoukaiqi/js/utils.js"></script>

<script src="/zhoukaiqi/js/motion.js"></script>


<script src="/zhoukaiqi/js/schemes/pisces.js"></script>


<script src="/zhoukaiqi/js/next-boot.js"></script>

<script src="/zhoukaiqi/js/bookmark.js"></script>




  















  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : true,
      notify     : true,
      appId      : 'vhaMl8P0P4xJswMKyBQOipdV-9Nh9j0Va',
      appKey     : 'AcrIkuQ87G3eyWyI9n6DVLwV',
      placeholder: "写点什么...",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
